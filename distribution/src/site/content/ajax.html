<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
<title>Ajax</title>
</head>
<body>


<h2>Waffle and Ajax</h2>
<p>Waffle was built to be easy to develop with and this ease extends
to Ajax support as well. Utilizing AJAX in Waffle application is
straightforward and simple. The examples here use the <a
  href="http://prototype.conio.net/">Prototype JavaScript Framework</a>.</p>
<h3>Ajax Controller</h3>
<p>We will create a simple Controller with an event (<b>int
random();</b>) that will return a random number between 0 and 10. To make it
more interesting whenever the value equals 5 the event will throw an
Exception.</p>
<div class="source"><pre>public class FoobarController implements Serializable {
    private Random random = new Random();

    /**
     * the event
     */
    public int random() throws Exception {
        int value = Math.abs(random.nextInt() % 10);

        if (value == 5) {
            throw new Exception(&quot;Random Exception!&quot;);
        }

        return value;
    }
}</pre></div>
</div>
<h3>Ajax-ified View</h3>
<p>So we create a simple View that will periodically (every 2
seconds is the default) request a new value from the Server.</p>
<ul>
  <li>We import the prototype javascript file to provide the ajax
  foundation</li>
  <li>The custom ajax call is <b>new
  Ajax.PeriodicalUpdater(&quot;random&quot;,
  &quot;foobar.waffle?method=random&quot;);</b>
  <ul>
    <li>The first argument <b>&quot;random&quot;</b> refers to the
    element id tag in the html (the <i>&lt;div&gt;</i>)</li>
    <li>The second argument <b>foobar.waffle?method=random</b>
    represents what will be periodically called to the server.
    <ul>
      <li><b>foobar.waffle</b> the Action is registered under the
      key value &quot;<i>foobar</i>&quot;.</li>
      <li>&quot;method=random&quot; signifies that the
      &quot;random&quot; ActionMethod method will be called on the
      Controller.
      <div class="source"><pre>&lt;html&gt;
&lt;head&gt;
    &lt;script type=&quot;text/javascript&quot; src=&quot;scripts/prototype-1.5.js&quot;&gt;&lt;/script&gt;
    &lt;script type=&quot;text/javascript&quot;&gt;
        new Ajax.PeriodicalUpdater(&quot;random&quot;, &quot;foobar.waffle?method=random&quot;);
    &lt;/script&gt;
&lt;/head&gt;
    &lt;h1&gt;Random value from Server: &lt;div id=&quot;random&quot;&gt;&lt;/div&gt;&lt;/h1&gt;
&lt;/html&gt;</pre></div>
      </li>
    </ul>
    </li>
  </ul>
  </li>
</ul>
</div>
<h3>Wire it up with the Registrar</h3>
<p>The <i>FoobarController</i> is registered under the name &quot;<i>foobar</i>&quot;.
Notice that the Controller is being registered to the Application level
context.</p>
<div class="source"><pre>public class CustomRegistrar extends AbstractRegistrar {
    public CustomRegistrar(Registrar delegate) {
        super(delegate);
    }

    public void application() {
        register(&quot;foobar&quot;, FoobarController.class);
    }
}</pre></div>
</div>
<h3>Partial page rendering</h3>
<p>By simply having an <i>ActionMethod</i> invoked through an
asynchronous call which return <i>View</i>'s you'll be able to build
your web applications to take advantage of partial page rendering.</p>
<p>TODO ... need example!!! ...</p>
</div>
<div id="footer">
<div class="xright">&#169; 2007</div>
<div class="clear">
<hr />
</div>
</div>

</body>

</html>
