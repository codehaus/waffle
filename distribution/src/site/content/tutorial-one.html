<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
  <head>
    <title></title>
      </head>
  <body>
  
      
        <h2>Tutorial: Part One</h2><p>This tutorial is available to give a quick glimpse of how to use Waffle. It touches on each of the main components that make up Waffle.</p><h3>Controller</h3><p>The term <b>Controller</b> is probably familiar to those who have worked with other web frameworks. An Controller in Waffle can be any java object (i.e. Pojo). However, in order for a Pojo to be considered an Controller in Waffle it needs to be registered with the <b>Registrar</b>. The Registrar is a simple class that your application must implement. The Registrar provides a few methods that allows you to register your pojo's as Controllers. For complete details on the Registrar have a look at the <a href="registrar.html">Registrar</a> section.</p><p>Now we will write a very simple class to use as an Controller. The class below is really nothing more than a simple bean type of object.</p><div class="source"><pre>public class Automobile implements Serializable {
    private String make = &quot;ford&quot;;
    private String model = &quot;gt-40&quot;;

    public String getMake() {
        return make;
    }

    public void setMake(String make) {
        this.make = make;
    }

    public String getModel() {
        return model;
    }

    public void setModel(String model) {
        this.model = model;
    }
}</pre></div></div><h3>Registrar</h3><p>As stated earlier, a Controller is not an Controller in Waffle until it has been registered with the Registrar. So now we will create a simple Registrar class and register the <b>Automobile</b> class with it. The MyRegistrar class below defines the method &quot;<b>session</b>&quot; and within that method it calls <b>register(&quot;automobile&quot;, Automobile.class);</b>, which registers our Automobile class as an Controller under the name &quot;automobile&quot;. Registration is not limited to Controllers because any component, service, factory, etc... can be registered. Detailed examples of this will be discussed later.</p><div class="source"><pre>public class MyRegistrar extends org.codehaus.waffle.registrar.AbstractRegistrar {

    public MyRegistrar(Registrar delegate) {
        super(delegate);
    }

    public void session() {
        register(&quot;automobile&quot;, Automobile.class);
    }
}</pre></div></div><h3>web.xml</h3><p>While Waffle does not require any proprietary XML configuration files we still must create a <b>web.xml</b>. The web.xml example below has four points worth mentioning.</p><ol type="1"><li><b>org.codehaus.waffle.registrar.Registrar</b> is the key used to register your applications custom Registrar. The key is the fully qualified name of the basic Registrar interface.</li><li><b>org.codehaus.waffle.context.WaffleContextListener</b> needs to be registered as a listener so that Waffle can be notified of context level (application, session) events.</li><li><b>org.codehaus.waffle.context.WaffleRequestFilter</b> this is the Filter Waffle uses to handle request level events. This is superior to a RequestAttributeListeners implementation because we can ensure a request level container will only be created when appropriate (i.e. not when images or cascading style sheets are requested).</li><li><b>org.codehaus.waffle.WaffleServlet</b> is Waffle's front controller for handling requests.<div class="source"><pre>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;web-app version=&quot;2.4&quot;
         xmlns=&quot;http://java.sun.com/xml/ns/j2ee&quot;
         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
         xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/j2ee
            http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd&quot;&gt;
    &lt;display-name&gt;Waffle Tutorial Example&lt;/display-name&gt;

    &lt;!-- 1. This is how an application registers it custom Registrar --&gt;
    &lt;context-param&gt;
        &lt;param-name&gt;org.codehaus.waffle.registrar.Registrar&lt;/param-name&gt;
        &lt;param-value&gt;MyRegistrar&lt;/param-value&gt;
    &lt;/context-param&gt;

    &lt;!-- 2. Waffle context listener (ServletContext and HttpSession) --&gt;
    &lt;listener&gt;
        &lt;listener-class&gt;org.codehaus.waffle.context.WaffleContextListener&lt;/listener-class&gt;
    &lt;/listener&gt;

    &lt;!-- 3. Waffle request filter (responsible for request level context) --&gt;
    &lt;filter&gt;
        &lt;filter-name&gt;WaffleRequestFilter&lt;/filter-name&gt;
        &lt;filter-class&gt;org.codehaus.waffle.context.WaffleRequestFilter&lt;/filter-class&gt;
    &lt;/filter&gt;
    &lt;filter-mapping&gt;
        &lt;filter-name&gt;WaffleRequestFilter&lt;/filter-name&gt;
        &lt;url-pattern&gt;*.waffle&lt;/url-pattern&gt;
    &lt;/filter-mapping&gt;

    &lt;!-- 4. Register Waffle's FrontController servlet --&gt;
    &lt;servlet&gt;
        &lt;servlet-name&gt;waffle&lt;/servlet-name&gt;
        &lt;servlet-class&gt;org.codehaus.waffle.servlet.WaffleServlet&lt;/servlet-class&gt;
        &lt;init-param&gt;
            &lt;param-name&gt;view.suffix&lt;/param-name&gt;
            &lt;param-value&gt;.jsp&lt;/param-value&gt;
        &lt;/init-param&gt;
        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;waffle&lt;/servlet-name&gt;
        &lt;url-pattern&gt;*.Controller&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;</pre></div></li></ol></div><h3>View</h3><p>We will create a very simple view to display the content of the Controller. The following example uses a JSP and simply displays the values of the Controller.</p><h4>automobile.jsp</h4><div class="source"><pre>&lt;%@ page contentType=&quot;text/html;charset=UTF-8&quot; language=&quot;java&quot; %&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;

&lt;html&gt;
&lt;form action=&quot;automobile.waffle&quot;&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;Make: &lt;/td&gt;
            &lt;td&gt;
                &lt;input type=&quot;text&quot; value=&quot;&lt;c:out value='${controller.make}'/&gt;&quot; name=&quot;make&quot;/&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Model: &lt;/td&gt;
            &lt;td&gt;
                &lt;input type=&quot;text&quot; value=&quot;&lt;c:out value='${controller.model}'/&gt;&quot; name=&quot;model&quot;/&gt;
            &lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    &lt;input type=&quot;submit&quot;/&gt;
&lt;/form&gt;
&lt;/html&gt;</pre></div></div></div><h3>Application structure (WAR File)</h3><p>An application built with Waffle is similar to most other Java web based applications. The following provides an overview of how you might layout the code for this tutorial:</p><div class="source"><pre>   +--- WEB-INF/
       +--- classes/
           +--- Automobile.class
           +--- MyRegistrar.class
       +--- lib/
           +--- jstl.jar
           +--- standard.jar
           +--- ognl.jar
           +--- picocontainer.jar
           +--- waffle-1.x.jar
       +--- web.xml
   +--- automobile.jsp</pre></div><dl><dt>NOTE</dt><dd>The jars <b>jstl.jar</b> and <b>standard.jar</b> are only required because this tutorial demonstrates the use of JSP's. If you plan on using <a href="http://freemarker.sourceforge.net/">FreeMarker</a> or <a href="http://jakarta.apache.org/velocity/index.html">Velocity </a> you'll need to include the jar files that each of those projects may require.</dd></dl></div><h3>Running the application</h3><p>Now the application can be deployed to a Servlet container (e.g., Tomcat, Jetty). So when we run the application and direct the browser to <b>http://localhost:8080/hello/automobile.waffle</b> we see the following:</p><img src="images/browser-1.png" /><p>When Waffle's front controller, WaffleServlet, handled this request it first located the &quot;automobile&quot; Controller, which we registered earlier to the session.</p><p>We can also exercise the ability to bind values from the request directly onto the Controller. If we append the value &quot;<b>?model=ranger</b>&quot; to the original url we will now have: <b>http://localhost:8080/hello/automobile.waffle?model=ranger</b>. Notice that the url and the value of the Model field has been updated.</p><img src="images/browser-2.png" /></div><h3>More to see</h3><p>This has only been an introduction to Waffle and it provides a good starting point to understanding how it works. Continue on to <a href="tutorial-two.html">Tutorial: Part two</a> to see how <b>ControllerMethods</b> can be dynamically invoked on Controllers.</p></div>
  </body>

</html>
